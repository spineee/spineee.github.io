<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>test</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; }
        .tab-card { border: 1px solid #0f0; padding: 10px; margin: 10px 0; }
        input { background: #111; color: #0f0; border: 1px solid #0f0; width: 400px; padding: 5px; }
    </style>
</head>
<body>
    <hr>
    <div id="output"></div>

    <script>
        function checkTab() {
            const wsUrl = "wss://127.0.0.1:9222";
            // 关键点：即使在 HTTPS 页面，某些浏览器仍允许向 127.0.0.1 发起不安全 ws 连接
            const ws = new WebSocket(wsUrl);
            const out = document.getElementById('output');

            ws.onopen = () => {
                out.innerHTML += `<div class="tab-card">成功连接！<br>该标签页存活。</div>`;
                ws.send(JSON.stringify({id: 1, method: "Browser.getVersion"}));
            };

            ws.onmessage = (e) => {
                out.innerHTML += `<div>响应: ${e.data}</div>`;
                ws.close();
            };

            ws.onerror = () => {
                out.innerHTML += `<div style="color:red">连接失败。可能原因：混合内容拦截或端口未开放。</div>`;
            };
        }
        checkTab()
    </script>
</body>
</html>
